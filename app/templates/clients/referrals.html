{% extends "layout/dashboard_base.html" %}

{% block dashboard_content %}
<div class="space-y-6">
    
    <div class="flex justify-between items-end">
        <div>
            <h1 class="text-2xl font-bold text-white">Fleet Builder</h1>
            <p class="text-slate-400">Build your own digital fleet. Earn <span class="text-green-400 font-bold">$75/month</span> for every active truck you refer.</p>
        </div>
        <div class="bg-green-900/20 border border-green-500/30 px-4 py-2 rounded-lg text-right">
            <p class="text-xs text-green-400 uppercase font-bold">Monthly Passive Income</p>
            <p class="text-2xl font-black text-white">${{ monthly_earnings or 0 }}</p>
        </div>
    </div>

    <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-lg">
        <label class="block text-sm font-medium text-slate-300 mb-2">Your Referral Link</label>
        <div class="flex gap-2">
            <input type="text" readonly value="https://greencandledispatch.com/register?ref={{ user.referral_code }}" 
                class="flex-1 bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white font-mono text-sm focus:ring-green-500 focus:border-green-500" id="refLink">
            <button onclick="copyLink()" class="bg-green-500 hover:bg-green-400 text-slate-900 font-bold px-6 rounded-lg transition">
                Copy
            </button>
        </div>
        <p class="text-xs text-slate-500 mt-2">
            Share this link with other drivers. When they sign up and start factoring with OTR, you start earning.
        </p>
    </div>

    <div class="grid md:grid-cols-3 gap-6">
        <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
            <div class="text-3xl mb-2">ðŸš›</div>
            <h3 class="text-white font-bold">1 Referral</h3>
            <p class="text-slate-400 text-sm mb-2">Pays for your coffee.</p>
            <p class="text-2xl font-bold text-green-400">$75 <span class="text-xs text-slate-500">/mo</span></p>
        </div>
        <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
            <div class="text-3xl mb-2">ðŸš›ðŸš›ðŸš›ðŸš›ðŸš›</div>
            <h3 class="text-white font-bold">5 Referrals</h3>
            <p class="text-slate-400 text-sm mb-2">Pays for your fuel.</p>
            <p class="text-2xl font-bold text-green-400">$375 <span class="text-xs text-slate-500">/mo</span></p>
        </div>
        <div class="bg-slate-900 p-6 rounded-xl border border-green-500/30 shadow-lg shadow-green-900/20 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-24 h-24 bg-green-500/10 rounded-full blur-xl"></div>
            <div class="text-3xl mb-2">ðŸš€</div>
            <h3 class="text-white font-bold">10 Referrals</h3>
            <p class="text-slate-400 text-sm mb-2">Pays your truck note.</p>
            <p class="text-2xl font-bold text-green-400">$750 <span class="text-xs text-slate-500">/mo</span></p>
        </div>
    </div>

    <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-700">
            <h3 class="font-bold text-white">Your Recruits</h3>
        </div>
        <table class="w-full text-left">
            <thead class="bg-slate-900 text-xs text-slate-400 uppercase">
                <tr>
                    <th class="px-6 py-3">Driver</th>
                    <th class="px-6 py-3">Join Date</th>
                    <th class="px-6 py-3">Status</th>
                    <th class="px-6 py-3 text-right">Commission</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-700 text-sm">
                {% for referral in referrals %}
                <tr>
                    <td class="px-6 py-4 text-white font-mono">{{ referral.mc_number }}</td>
                    <td class="px-6 py-4 text-slate-400">{{ referral.created_at.strftime('%b %d, %Y') }}</td>
                    <td class="px-6 py-4">
                        {% if referral.factoring_status == 'ACTIVE' %}
                            <span class="bg-green-900/30 text-green-400 px-2 py-1 rounded-full text-xs font-bold">Active</span>
                        {% else %}
                            <span class="bg-yellow-900/30 text-yellow-400 px-2 py-1 rounded-full text-xs font-bold">Pending</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-right font-bold text-green-400">
                        {% if referral.factoring_status == 'ACTIVE' %}
                            $75.00
                        {% else %}
                            $0.00
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" class="px-6 py-8 text-center text-slate-500">
                        You haven't referred anyone yet. Share your link above!
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function copyLink() {
        var copyText = document.getElementById("refLink");
        copyText.select();
        copyText.setSelectionRange(0, 99999); 
        navigator.clipboard.writeText(copyText.value);
        alert("Link copied to clipboard: " + copyText.value);
    }
</script>
{% endblock %}